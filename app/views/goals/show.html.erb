<div class="max-w-4xl mx-auto space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <div class="flex items-center gap-4">
      <%= link_to goals_path, 
          class: "text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      <% end %>
      
      <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white"><%= @goal.title %></h1>
        <div class="flex items-center gap-3 mt-2">
          <!-- Goal Type Badge -->
          <span class="inline-flex items-center px-2.5 py-1 rounded-full text-sm font-medium bg-<%= @goal.goal_type_color %>-100 text-<%= @goal.goal_type_color %>-800 dark:bg-<%= @goal.goal_type_color %>-800 dark:text-<%= @goal.goal_type_color %>-100">
            <%= @goal.goal_type.humanize %>
          </span>
          
          <!-- Status Badge -->
          <span class="inline-flex items-center px-2.5 py-1 rounded-full text-sm font-medium bg-<%= @goal.status_color %>-100 text-<%= @goal.status_color %>-800 dark:bg-<%= @goal.status_color %>-800 dark:text-<%= @goal.status_color %>-100">
            <%= @goal.status.humanize %>
          </span>

          <% if @goal.overdue? %>
            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100">
              Overdue
            </span>
          <% elsif @goal.due_soon? %>
            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100">
              Due Soon
            </span>
          <% end %>
        </div>
      </div>
    </div>
    
    <div class="flex gap-3">
      <%= link_to "Edit Goal", edit_goal_path(@goal), 
          class: "inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors",
          data: { turbo_frame: "goal_modal" } %>
      
      <% unless @goal.completed? %>
        <%= button_tag "Update Progress", 
            class: "inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",
            data: { action: "click->modal#open", modal_target: "update_progress" } %>
      <% end %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Description -->
      <% if @goal.description.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Description</h2>
          <p class="text-gray-600 dark:text-gray-400 leading-relaxed"><%= simple_format(@goal.description) %></p>
        </div>
      <% end %>

      <!-- Progress Details -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Progress Details</h2>
        
        <!-- Large Progress Bar -->
        <div class="mb-6">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Overall Progress</span>
            <span class="text-lg font-bold text-gray-900 dark:text-white">
              <%= number_to_percentage(@goal.progress_percentage, precision: 1) %>
            </span>
          </div>
          
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4">
            <div class="bg-<%= @goal.goal_type_color %>-500 h-4 rounded-full transition-all duration-300" 
                 style="width: <%= [@goal.progress_percentage, 100].min %>%"></div>
          </div>
        </div>

        <!-- Amount Breakdown -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
            <div class="text-2xl font-bold text-green-600 dark:text-green-400">
              $<%= number_with_delimiter(@goal.current_amount, delimiter: ",") %>
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Current Amount</div>
          </div>
          
          <div class="text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
              $<%= number_with_delimiter(@goal.target_amount, delimiter: ",") %>
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Target Amount</div>
          </div>
          
          <div class="text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
            <div class="text-2xl font-bold text-orange-600 dark:text-orange-400">
              $<%= number_with_delimiter(@goal.remaining_amount, delimiter: ",") %>
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Remaining</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Goal Info -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Goal Information</h3>
        
        <div class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Target Date</dt>
            <dd class="mt-1 text-sm text-gray-900 dark:text-white">
              <%= @goal.target_date.strftime("%B %d, %Y") %>
            </dd>
          </div>
          
          <div>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Days Remaining</dt>
            <dd class="mt-1 text-sm <%= @goal.overdue? ? 'text-red-600 dark:text-red-400' : 'text-gray-900 dark:text-white' %>">
              <% if @goal.overdue? %>
                Overdue by <%= (@goal.target_date - Date.current).abs.to_i %> days
              <% else %>
                <%= @goal.days_remaining %> days
              <% end %>
            </dd>
          </div>
          
          <% if @goal.category %>
            <div>
              <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Category</dt>
              <dd class="mt-1 flex items-center text-sm text-gray-900 dark:text-white">
                <div class="w-3 h-3 rounded-full mr-2" style="background-color: <%= @goal.category.color %>"></div>
                <%= @goal.category.name %>
              </dd>
            </div>
          <% end %>
          
          <div>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Created</dt>
            <dd class="mt-1 text-sm text-gray-900 dark:text-white">
              <%= @goal.created_at.strftime("%B %d, %Y") %>
            </dd>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Actions</h3>
        
        <div class="space-y-3">
          <% unless @goal.completed? %>
            <%= button_tag "Update Progress", 
                class: "w-full inline-flex justify-center items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",
                data: { action: "click->modal#open", modal_target: "update_progress" } %>
          <% end %>
          
          <%= link_to "Edit Goal", edit_goal_path(@goal), 
              class: "w-full inline-flex justify-center items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors",
              data: { turbo_frame: "goal_modal" } %>
          
          <%= link_to "Delete Goal", goal_path(@goal), 
              method: :delete,
              class: "w-full inline-flex justify-center items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors",
              data: { 
                turbo_method: :delete,
                turbo_confirm: "Are you sure you want to delete this goal? This action cannot be undone."
              } %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Frame -->
<%= turbo_frame_tag "goal_modal", class: "hidden" do %>
<% end %>

<!-- Progress Update Modal (this will be handled by Stimulus) -->
<div id="update_progress_modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800">
    <div class="mt-3 text-center">
      <h3 class="text-lg font-medium text-gray-900 dark:text-white">Update Goal Progress</h3>
      
      <%= form_with model: @goal, url: update_progress_goal_path(@goal), method: :patch, class: "mt-4" do |f| %>
        <div class="mb-4">
          <%= f.label :amount, "New Current Amount", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" %>
          <%= f.number_field :amount, 
              step: 0.01, 
              min: 0, 
              max: @goal.target_amount,
              value: @goal.current_amount,
              class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white" %>
        </div>
        
        <div class="flex justify-center gap-3">
          <%= f.submit "Update Progress", 
              class: "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors" %>
          
          <%= button_tag "Cancel", type: "button",
              class: "px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium rounded-lg transition-colors",
              data: { action: "click->modal#close" } %>
        </div>
      <% end %>
    </div>
  </div>
</div>